// Generated by CoffeeScript 1.7.1
(function() {
  (function() {
    var $scroller, getFeed, serverURL, takePicture, upload;
    serverURL = "http://192.168.1.4:3000";
    $scroller = $(".scroller");
    getFeed = function() {
      $scroller.empty();
      $.ajax({
        url: serverURL + "/images",
        dataType: "json",
        type: "GET"
      }).done(function(data) {
        var i, l;
        l = data.length;
        i = 0;
        while (i < l) {
          $scroller.append("<img src=\"" + serverURL + "/" + data[i].fileName + "\"/>");
          i++;
        }
      });
    };
    upload = function(imageURI) {
      var ft, options;
      ft = new FileTransfer();
      options = new FileUploadOptions();
      options.fileKey = "file";
      options.fileName = "filename.jpg";
      options.mimeType = "image/jpeg";
      options.chunkedMode = false;
      options.params = {
        description: "Uploaded from my phone"
      };
      ft.upload(imageURI, serverURL + "/images", (function(e) {
        getFeed();
      }), (function(e) {
        alert("Upload failed");
      }), options);
    };
    takePicture = function(e) {
      var options;
      options = {
        quality: 45,
        targetWidth: 1000,
        targetHeight: 1000,
        destinationType: Camera.DestinationType.FILE_URI,
        encodingType: Camera.EncodingType.JPEG,
        sourceType: Camera.PictureSourceType.CAMERA
      };
      navigator.camera.getPicture((function(imageURI) {
        console.log(imageURI);
        upload(imageURI);
      }), (function(message) {}), options);
      return false;
    };
    $(".camera-btn").on("click", takePicture);
    getFeed();
  })();

}).call(this);
